{% extends "blog/base.html" %}
{% load crispy_forms_tags %}
{% block content %}

<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        a.disable {
          pointer-events: none;
          cursor: default;
        }

    </style>
</head>
<body>

    <main>
      <div class="container">
        <div class="messages-container">

        </div>



  <h3 class="review-title">
  <span class="text-muted">Welcome</span>
  <a href="{% url 'profile' %}" class="review-title-user">{{ user.username }}</a>

</h3>
<ul class="review-menu">
  <li>
    <a href="/scholar" >Databases</a>
  </li>
  <li>
    <a href="/snowballing" class="disable">Snowballing</a>
  </li>

    <li>
    <a href="/abstract" class="disable">Abstract Screening</a>
  </li>
        <li class="active">
    <a href="/fulltext">Full-Text Screening</a>
  </li>
    <li >
    <a href="/quality-assessment-questions" id="quality_question">Quality Assessment Questions</a>
  </li>
      <li >
    <a href="/quality-assessment" id="quality_assessment">Quality Assessment</a>
  </li>


</ul>
<input type="hidden" id="review-id" value="6085">

  <div class="row">
    <div class="col-sm-11 col-md-12 col-lg-13">
      <form method="post">
        <input type='hidden' name='csrfmiddlewaretoken' value='IZ6IugjtKNXR3KF5gJDWTVxuxeiZPf2i' />
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Relevant Articles</h3>
          </div>
          <div class="panel-body">


<section>

    <div class="content-section">
        <form method="POST">
            {% csrf_token %}
            <fieldset class = "form-group" >
<!--                <legend class="border-bottom mb-4">Enter keywords to search abstract</legend>-->
<!--                <p>Query: <input type="text" name="query"></p>-->
<!--                    {{ form|crispy }}-->

<!--                <p><input type="submit" class = "btn btn-primary" value="submit"></p>-->
<!--            <h3>Population Results</h3>-->
<!--             <table id="population" style="width:100%">-->

<!--                  <thead>-->
<!--                    <tr>-->
<!--                        <th>Research Paper Title</th>-->
<!--                        <th>Scores</th>-->
<!--                    </tr>-->
<!--                    </thead>-->
<!--                <tbody>-->
<!--                  {% for i in fulltext_list.0 %}-->
<!--                    <tr >-->
<!--                       <td ><a href= {{i.doi}} target="_blank"> {{ i.title }} </a></td>-->
<!--                        <td > {{ i.score }}</td>-->
<!--                    </tr>-->


<!--                    {% endfor %}-->

<!--                    </tbody>-->

<!--                </table>-->
<!--                <h3>Intervention Results</h3>-->
<!--             <table id="intervention" style="width:100%">-->

<!--                  <thead>-->
<!--                    <tr>-->
<!--                        <th>Research Paper Title</th>-->
<!--                        <th>Scores</th>-->
<!--                    </tr>-->
<!--                    </thead>-->
<!--                <tbody>-->
<!--                  {% for i in fulltext_list.1 %}-->
<!--                    <tr >-->
<!--                       <td ><a href= {{i.doi}} target="_blank"> {{ i.title }} </a></td>-->
<!--                        <td > {{ i.score }}</td>-->
<!--                    </tr>-->


<!--                    {% endfor %}-->

<!--                    </tbody>-->

<!--                </table>-->
<!--                <h3>Comparison Results</h3>-->
<!--                <table id="comparison" style="width:100%">-->

<!--                  <thead>-->
<!--                    <tr>-->
<!--                        <th>Research Paper Title</th>-->
<!--                        <th>Scores</th>-->
<!--                    </tr>-->
<!--                    </thead>-->
<!--                <tbody>-->
<!--                  {% for i in fulltext_list.2 %}-->
<!--                    <tr >-->
<!--                       <td ><a href= {{i.doi}} target="_blank"> {{ i.title }} </a></td>-->
<!--                        <td > {{ i.score }}</td>-->
<!--                    </tr>-->


<!--                    {% endfor %}-->

<!--                    </tbody>-->

<!--                </table>-->
<!--                <h3>Outcome Results</h3>-->
<!--                <table id="outcome" style="width:100%">-->

<!--                  <thead>-->
<!--                    <tr>-->
<!--                        <th>Research Paper Title</th>-->
<!--                        <th>Scores</th>-->
<!--                    </tr>-->
<!--                    </thead>-->
<!--                <tbody>-->
<!--                  {% for i in fulltext_list.3 %}-->
<!--                    <tr >-->
<!--                       <td ><a href= {{i.doi}} target="_blank"> {{ i.title }} </a></td>-->
<!--                        <td > {{ i.score }}</td>-->
<!--                    </tr>-->


<!--                    {% endfor %}-->

<!--                    </tbody>-->

<!--                </table>-->
<!--                <h3>Context Results</h3>-->
<!--                <table id="context" style="width:100%">-->

<!--                  <thead>-->
<!--                    <tr>-->
<!--                        <th>Research Paper Title</th>-->
<!--                        <th>Scores</th>-->
<!--                    </tr>-->
<!--                    </thead>-->
<!--                <tbody>-->
<!--                  {% for i in fulltext_list.4 %}-->
<!--                    <tr >-->
<!--                       <td ><a href= {{i.doi}} target="_blank"> {{ i.title }} </a></td>-->
<!--                        <td > {{ i.score }}</td>-->
<!--                    </tr>-->


<!--                    {% endfor %}-->

<!--                    </tbody>-->

<!--                </table>-->
                <div id="multipleDatatables" class="container"></div>
<!--                <h3>Research Question 1 Results</h3>-->
<!--                <table id="rq1" style="width:100%">-->

<!--                  <thead>-->
<!--                    <tr>-->
<!--                        <th>Research Paper Title</th>-->
<!--                        <th>Scores</th>-->
<!--                    </tr>-->
<!--                    </thead>-->
<!--                <tbody>-->
<!--                  {% for i in fulltext_list.5 %}-->
<!--                    <tr >-->
<!--                       <td ><a href= {{i.doi}} target="_blank"> {{ i.title }} </a></td>-->
<!--                        <td > {{ i.score }}</td>-->
<!--                    </tr>-->


<!--                    {% endfor %}-->

<!--                    </tbody>-->

<!--                </table>-->
<!--                <h3>Research Question 2 Results</h3>-->
<!--                <table id="rq2" style="width:100%">-->

<!--                  <thead>-->
<!--                    <tr>-->
<!--                        <th>Research Paper Title</th>-->
<!--                        <th>Scores</th>-->
<!--                    </tr>-->
<!--                    </thead>-->
<!--                <tbody>-->
<!--                  {% for i in fulltext_list.6 %}-->
<!--                    <tr >-->
<!--                       <td ><a href= {{i.doi}} target="_blank"> {{ i.title }} </a></td>-->
<!--                        <td > {{ i.score }}</td>-->
<!--                    </tr>-->


<!--                    {% endfor %}-->

<!--                    </tbody>-->

<!--                </table>-->
<!--                <h3>Research Question 3 Results</h3>-->
<!--                <table id="rq3" style="width:100%">-->

<!--                  <thead>-->
<!--                    <tr>-->
<!--                        <th>Research Paper Title</th>-->
<!--                        <th>Scores</th>-->
<!--                    </tr>-->
<!--                    </thead>-->
<!--                <tbody>-->
<!--                  {% for i in fulltext_list.7 %}-->
<!--                    <tr >-->
<!--                       <td ><a href= {{i.doi}} target="_blank"> {{ i.title }} </a></td>-->
<!--                        <td > {{ i.score }}</td>-->
<!--                    </tr>-->


<!--                    {% endfor %}-->

<!--                    </tbody>-->

<!--                </table>-->
            </fieldset>


        </form>

    </div>


</section>


          </div>


        </div>



      </form>
    </div>

  </div>


      </div>
    </main>

 <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
<!--      <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>-->
<!--  <script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>-->

    <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>


    <script>
        $(document).ready(function () {
            $.ajax({
                url: '/ajax/fulltext/',
                type: 'GET',
                dataType: 'json',
            }).done(function(data) {
                console.log("data is ", data.full_text_map['population']);

                var count = 0;
                var totalDatatablesContent = "";
                for(var i of Object.keys(data.full_text_map)) {
                    var dataTableHtml = `
        <h3 id="heading${count}" style="padding-bottom: 20px;padding-top: 50px;"></h3>
            <table id="dataTable${count}" class="display" style="width:100%;">
            <thead>
                <tr>
                    <th>Article Link</th>
                    <th>Title</th>
                    <th>Score</th>

                </tr>
            </thead>
            <tfoot>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </tfoot>
        </table>`;

                    totalDatatablesContent += dataTableHtml;


                    $("#multipleDatatables").html(totalDatatablesContent);
                    count += 1;
                }
                var count = 0;
                for(var i of Object.keys(data.full_text_map)) {
                    $(`#heading${count}`).html(`${(count+1)} - ${i.charAt(0).toUpperCase() + i.slice(1)}` );
                    var dat = data.full_text_map[i];
                    console.log("i is ", i);
                    console.log("data is ", data.full_text_map[i]);
                    generateDatatable(`dataTable${count}`, dat);
                    count += 1;
                }
            }).fail(function () {
                console.log("Data not present")
            });
        });
            // var list_results = {{ fulltext_list}};



    </script>
    <script>
        function generateDatatable(dataTableName, data){

    $(`#${dataTableName}`).dataTable( {
        dom: 'Bfrtip',
        buttons: [
        'copy', 'csv', 'excel', 'pdf','print'
        ],
        data: data,
         order: [[ 2, 'desc' ]],
        columns: [
             {
                "render": function (data, type, row, meta ) {
                    return '<a  href='+row[0]+'>'+row[0]+' </a>';
                }

            },
             {title: "Title"},
            { title: "Score" }
        ]
    });

}
    </script>
<!--    <script src="/static/js/mustache.min.js"></script>-->
<!--  <script src="/static/js/jquery-1.11.3.min.js"></script>-->
<!--  <script src="/static/js/bootstrap.min.js"></script>-->
<!--  <script src="/static/js/jquery.tablesorter.min.js"></script>-->
<!--  <script src="/static/js/selectize.min.js"></script>-->
<!--  <script src="/static/js/expanding.js"></script>-->
<!--  <script src="/static/js/parsifal.js?v=2"></script>-->
</body>
{% endblock content %}

</html>